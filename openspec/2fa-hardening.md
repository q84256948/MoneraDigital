# OpenSpec: 2FA 安全加固与体验优化

## 1. 目标
通过静态加密、恢复码机制以及更优的 UI 组件，将 2FA 系统提升至金融级安全与易用标准。

## 2. 核心改进
### 2.1 静态加密 (P0)
- 使用 `crypto` 模块（AES-256-GCM）对数据库中的 `two_factor_secret` 进行加密存储。
- 引入 `ENCRYPTION_KEY` 环境变量作为主密钥。

### 2.2 恢复码机制 (P1)
- **数据库**: 在 `users` 表增加 `two_factor_backup_codes` 字段（加密存储 JSON 数组）。
- **流程**: 开启 2FA 时生成 10 个随机恢复码，展示给用户并要求下载。
- **校验**: 登录时若主验证码失效，允许使用恢复码，使用后立即作废。

### 2.3 UI 升级 (P2)
- 使用 Shadcn UI 的 `InputOTP` 组件替换普通输入框，提供分段式输入体验。

## 3. 验证标准
- 密钥加密解密逻辑的单元测试覆盖率 100%。
- 验证恢复码使用一次后即刻作废的逻辑。
