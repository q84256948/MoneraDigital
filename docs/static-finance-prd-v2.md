# Monera Digital 静态理财产品需求文档 (PRD) v2.0

## 1. 文档概述
本文档旨在规范 Monera Digital 平台“静态理财（定期产品）”的业务逻辑、技术要求及安全合规准则。该产品定位为封闭式、定期派息、到期还本的稳健型理财工具。

### 1.1 修订记录
| 版本 | 修订内容 | 作者 | 时间 |
| :--- | :--- | :--- | :--- |
| v1.0 | 初始版本，基于原始 HTML 文档转换 | 产品团队 | 2026-01-06 |
| v2.0 | 整合自动申购、利率优化、IP限制、利息公式修正及 Safeheron 集成 | 架构组 | 2026-01-06 |

---

## 2. 核心业务逻辑与优化

### 2.1 产品特性
- **封闭期管理**：产品在持有期内默认不支持赎回。若后台配置允许提前赎回，则需扣除已发放利息作为违约金。
- **确认机制**：T日申购，T+1日 12:00 系统自动确认（以确认时的产品利率为准）。
- **计息规则**：T+1日 08:00 开始计息，支持每日派息至理财账户。

### 2.2 自动申购 (Auto-Reinvestment) - **新增**
- **功能描述**：用户开启后，当理财订单到期时，系统自动发起续购申请。
- **续购金额**：续购金额 = 原订单本金 + 累计产生的利息。
- **续购规则**：
    - 自动申购相同期限的同款产品。
    - 续购在到期日当天执行，新订单于次日（D+1）起息。
- **交互控制**：用户可在“申购记录”或“产品详情”页随时开启/关闭此功能。

### 2.3 利率动态优化 (Rate Flexibility) - **新增**
- **逻辑**：实行“利率变产品不变”设计模式。
- **说明**：平台管理后台调整年化利率时，直接更新现有产品 ID 的利率属性。
- **影响**：已开启“自动申购”的订单在下一次续购时，自动应用系统当前生效的最新利率，保持用户投资历史的连续性，无需创建冗余产品。

### 2.4 确认与预警机制 - **新增**
- **到期预警**：订单到期前 3 天（T-3），系统自动触发邮件通知。
- **邮件内容**：提醒用户订单即将到期，并告知当前的“自动申购”状态（已开启/未开启），引导用户根据市场利率决定是否调整策略。

---

## 3. 合规与风控限制

### 3.1 IP 地理围栏限制 - **新增**
- **限制规则**：针对 **单笔申购金额 < 10,000 USDT** 的订单，限制 **新加坡 IP** 访问。
- **执行逻辑**：
    1. 获取请求源 IP。
    2. 校验 IP 所属地是否为新加坡。
    3. 若满足（新加坡 IP 且 金额 < 10,000U），前端阻断申购按钮，后端 API 拒绝提交并返回特定错误码。

### 3.2 计息公式修正 - **优化**
- **修正原则**：利息计算必须严格体现持有天数，确保精度。
- **公式**：
    - `日利息 = 申购数量 * (年化利率 / 365)`
    - `预期总收益 = 申购数量 * 年化利率 * (产品期限 / 365)`
    - `到期还本付息 = 申购本金 + 累计已发放利息`

---

## 4. 资金存管与 Safeheron 集成

### 4.1 充币对接 (Deposit)
1. **地址生成**：用户发起充币请求时，系统调用 Safeheron `create_deposit_address` 接口。
2. **状态监听**：通过 Webhook 接收 `deposit_confirmed` 事件。
3. **入账确认**：系统校验交易哈希和金额，确认无误后更新 `user_assets` 表，增加理财余额。

### 4.2 提币对接 (Withdraw)
1. **业务校验**：校验地址白名单、单日提币限额及 2FA 验证。
2. **提币发起**：调用 Safeheron `create_withdraw_request` 接口。
3. **多签审批**：提币请求进入 Safeheron 待审批池，由公司多签持有人通过 Safeheron APP 进行手动审批。
4. **结算闭环**：监听 `withdraw_confirmed` 回调，将系统订单状态更新为“已完成”，并记录区块链交易 ID。

---

## 5. UI/UX 交互规范

### 5.1 排序逻辑
- **理财首页**：产品列表默认按 **年化利率 (APR)** 从高到低排序。

### 5.2 字段文案优化
- **剩余可投**：由原先的点击整行填充改为点击新增的 **“最大”** 按钮进行自动填充。
- **文案变更**：
    - “我的钱包” -> “我的资产”
    - “剩余可投” -> “本次可投”
    - “我还能投” -> “剩余可购”

---

## 6. 技术实现要点 (Non-Functional)
- **高并发处理**：在 T+1 12:00 进行批量订单确认时，需使用消息队列（MQ）进行异步处理，避免数据库死锁。
- **精度控制**：所有涉及资产计算的字段统一使用 `Decimal(36, 18)` 类型存储。
- **日志审计**：所有与 Safeheron 的 API 交互必须存储原始 Payload 以备后续安全审计。