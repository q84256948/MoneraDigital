# Monera Digital 静态理财产品需求文档 (PRD) v3.0

## 1. 文档概述
本文档是 Monera Digital 平台“静态理财（定期产品）”的终极业务规范。它整合了原始 Axure 设计的所有逻辑细节，并根据最新业务发展需求进行了功能扩展与安全性增强。

### 1.1 修订记录
| 版本 | 修订内容 | 作者 | 时间 |
| :--- | :--- | :--- | :--- |
| v1.0 | 初始版本，基于原始 HTML 文档转换 | 产品团队 | 2026-01-06 |
| v2.0 | 整合自动申购、利率优化、IP限制、Safeheron 对接 | 架构组 | 2026-01-06 |
| v3.0 | 深度整合原始文档所有交互细节、状态流转及结算逻辑 | 架构组 | 2026-01-06 |

---

## 2. 产品定义与流程

### 2.1 产品模型
- **类型**：封闭式预期收益型。
- **确认逻辑**：T日申购（待确认状态），T+1日 12:00 进行系统撮合确认。
- **计息逻辑**：确认成功后，T+1日 08:00 开始计息。
- **派息逻辑**：每日派息，利息发放至理财账户。到期时返还本金及最后一期利息。

### 2.2 核心业务流程
1. **申购阶段**：用户选择产品 -> 输入金额（校验限额、IP） -> 确认申购 -> 订单进入“待确认”队列。
2. **确认阶段**：系统根据产品剩余额度及时间优先原则进行撮合。
   - 额度充足：状态转为“资产划转中” -> “计息中”。
   - 额度不足：订单进入“已撤销”或“申购失败”流程。
3. **持有阶段**：每日 08:00 计算昨日利息 -> 累计至“累计利息”并派发。
4. **到期阶段**：
   - **非自动申购**：系统自动发起赎回流程 -> 资产划转回个人钱包。
   - **自动申购**：到期日自动以“本金 + 累计利息”续购同期限产品。

---

## 3. 核心功能优化 (新增与强化)

### 3.1 自动申购 (Auto-Reinvestment)
- **机制**：用户开启开关后，到期订单自动转为新申购订单。
- **金额**：续购总额 = 原订单本金 + 累计产生的利息（利息复投）。
- **利率策略**：**利率变产品不变**。续购时直接应用该产品 ID 的当前最新利率，无需关联新产品 ID，保持用户持仓历史的一致性。

### 3.2 确认与预警邮件
- **触发规则**：所有订单到期前 **3 天**。
- **操作**：系统发送确认邮件，提醒用户产品即将到期、当前的自动申购设置，以及预期回款金额。

### 3.3 申购限制 (Geo-Fencing & Limits)
- **IP 限制**：**单笔申购金额 < 10,000 USDT** 时，限制 **新加坡 IP** 访问和申购。
- **文案提示**：若触发限制，应提示“根据当地合规要求，该金额档位暂不对当前地区开放”。

---

## 4. 业务规则与计算公式

### 4.1 利息计算 (修正精度)
- **日利息** = `申购数量 * (年化利率 / 365)`
- **利息公式 (到期)** = `申购数量 * 年化利率 * (实际持有天数 / 365)`
- **资产存储精度**：所有涉及金额的计算与存储必须保留 18 位小数（Decimal 36, 18）。

### 4.2 判定逻辑
- **申购成功判定**：
  1. 产品状态必须为“上架”。
  2. 订单数量 ≤ 可申购额度。
  3. 若处于“锁定中额度”（资产划转中），该部分额度不计入可申购额度。

---

## 5. 状态流转图 (详细定义)

### 5.1 产品状态 (Product Status)
- **未发布**：编辑中。
- **已上架**：用户可见且可申购。
- **暂停申购**：用户可见但无法提交新订单。
- **已下架**：前端不显示。

### 5.2 订单状态 (Order Status)
- **待确认**：用户已提交。
- **申购失败**：额度不足或资产划转失败。
- **计息中**：正常持有。
- **已撤销**：用户手动取消或系统超时取消。
- **赎回中/已完成**：到期处理阶段。

---

## 6. Safeheron 集成规范

### 6.1 充提币自动化
- **充币 (Deposit)**：
  - 调用 `create_deposit_address` 生成充币地址。
  - Webhook 监听 `deposit_confirmed`，确认入账后自动增加理财账户余额。
- **提币 (Withdraw)**：
  - 调用 `create_withdraw_request` 发起提币申请。
  - 提币必须通过 Safeheron APP 进行 **人工多签审批**。
  - Webhook 监听 `withdraw_confirmed` 后更新本地订单状态。

---

## 7. 页面交互细节 (UI/UX)
- **产品排序**：理财首页产品默认按 **年化利率 (APR)** 从高到低排列。
- **字段文案统一**：
  - “我的钱包” 统一改为 “我的资产”。
  - “剩余可投” 统一改为 “本次可投”，并增加“最大”按钮。
  - “我还能投” 统一改为 “剩余可购”。
- **资产展示**：支持按币种分页展示，点击“详情”查看该币种下的所有定期订单。

---

## 8. 安全与风控
- **2FA 强制**：理财申购和提币操作必须开启 2FA。
- **审计日志**：记录所有 IP、地理位置、申购金额、API 交互 Payload。
- **异常告警**：若 Safeheron 钱包余额低于预警值，系统需向运维人员发送即时消息告警。
