# 产品需求文档：定期理财产品赎回功能

**版本号**: V1.0.0
**创建日期**: 2026-01-08
**文档类型**: 赎回流程需求文档
**审核人**: 待定

---

## 一、文档说明

### 版本设计策略

本文档包含 **三个产品版本设计**，按上线优先级排序：

| 版本 | 名称 | 特性 | 上线优先级 |
|-----|-----|------|----------|
| **C** | 封闭型 + 每日发息（无手续费）| 简洁、合规友好 | 🟢 V1.0（当前） |
| **A** | 封闭型 + 每日发息（有手续费）| 收费模式 | 🟡 V1.1（迭代） |
| **B** | 开放型 + 支持提前赎回 | 灵活、用户友好 | 🟠 V2.0（后续） |

---

## 二、版本 C（推荐首选）：封闭型 + 每日发息 + 无手续费

### 1. 核心业务逻辑

#### 1.1 产品特性
- ✅ **封闭型理财**：不支持提前赎回（到期日前无法赎回）
- ✅ **每日发息**：持有期间每日发放利息到账户
- ✅ **自动赎回**：到期日系统自动执行本息赎回
- ✅ **支持自动申购**：到期时可自动续期投资
- ✅ **无手续费**：申购、赎回、发息全流程无费用

#### 1.2 关键计算公式

**日利息公式（精确到秒）**：
```
日利息 = 申购本金 × 年化利率（APY） / 365

例：
- 申购本金：1000 USDT
- 年化利率：7%（即 0.07）
- 日利息 = 1000 × 0.07 / 365 = 0.1918 USDT（精确到小数点后4位）
```

**总利息公式（产品期限内）**：
```
总利息 = 日利息 × 产品期限天数
      = 申购本金 × 年化利率 / 365 × 产品期限天数

例（7天产品）：
- 总利息 = 1000 × 0.07 / 365 × 7 = 1.342466 USDT
```

**到期赎回金额公式**：
```
到期赎回金额 = 申购本金 + 总利息
            = 申购本金 + (申购本金 × APY / 365 × 产品期限天数)
            = 申购本金 × (1 + APY / 365 × 产品期限天数)

例（7天产品）：
- 到期赎回 = 1000 + 1.342466 = 1001.342466 USDT
- 或 = 1000 × (1 + 0.07/365 × 7) = 1001.342466 USDT
```

#### 1.3 自动申购续期公式

**续期本金计算**：
```
续期本金 = 申购本金 + 总利息
        = 第一期赎回金额

例：
- 第一期赎回：1001.342466 USDT
- 第二期申购本金：1001.342466 USDT
- 第二期总利息：1001.342466 × 0.07 / 365 × 7 = 1.3459 USDT
- 第二期赎回：1001.342466 + 1.3459 = 1002.688366 USDT
```

**复利效应**：
```
N期后本息和 = 申购本金 × (1 + APY/365 × 产品期限天数)^N

例（连续申购3期）：
- P = 1000, r = 0.07, d = 7, N = 3
- 3期后 = 1000 × (1 + 0.07/365 × 7)^3
        = 1000 × (1.001342466)^3
        = 1004.037 USDT
```

### 2. 业务流程设计

#### 2.1 时间轴与计息规则

```
T 日（申购发起日）
  ↓
用户点击"立即申购" → 确认订单信息 → 支付/扣款
  ↓
订单进入 PROCESSING 状态
  ↓
T+1 日 12:00（申购确认时刻）
  ↓
订单状态变为 HOLDING（持有中）
↓ 开始计息
  ↓
T+1 日 12:00 ~ T+N 日 11:59（持有期间）
  ↓
每日 12:00 发放日利息（自动入账理财账户）
  ↓
T+N 日 12:00（到期赎回时刻）
  ↓
系统自动执行赎回逻辑：
  ├─ 如果 auto_renew = 0 → 赎回本息到账户，订单结束
  └─ 如果 auto_renew = 1 → 创建新订单，本息继续申购
  ↓
赎回完成
```

#### 2.2 每日发息流程

**触发时刻**：每日 12:00（或系统配置的发息时刻）

**发息金额**：
```
当日发息 = 申购本金 × APY / 365

步骤：
1. 扫描所有 HOLDING 状态的订单
2. 对每笔订单计算当日利息
3. 生成 wealth_interest_record（type = PAYOUT，标记为已发放）
4. 用户理财账户余额 +日利息
5. 记录账务流水（biz_type = DAILY_INTEREST_PAYOUT）
```

#### 2.3 到期赎回流程

**触发时刻**：到期日 12:00（end_date = TODAY）

**赎回逻辑**：
```
1. 扫描到期订单（status = HOLDING AND end_date = CURDATE()）

2. 计算赎回金额：
   redeem_amount = principal + (principal × APY / 365 × duration)

3. 执行赎回：
   IF auto_renew = 0:
     ├─ 用户账户 + redeem_amount
     ├─ 系统账户 - redeem_amount
     ├─ 记录流水（REDEMPTION）
     └─ 订单状态 = REDEEMED（已赎回）

   ELSE IF auto_renew = 1:
     ├─ 创建新订单
     │  ├─ principal_new = redeem_amount
     │  ├─ start_date = CURDATE()
     │  ├─ end_date = CURDATE() + product.duration
     │  └─ auto_renew = user_setting
     ├─ 旧订单状态 = RENEWED（已续期）
     ├─ 旧订单链接新订单（renewed_to_order_id）
     └─ 新订单状态 = PROCESSING

4. 账务同步：
   用户账户余额 = 用户账户余额（无变化，本息自动投入新订单）
   系统账户余额 = 系统账户余额（无变化）
```

### 3. 用户界面与交互

#### 3.1 赎回确认页

**页面位置**：订单详情页 → 赎回按钮

**显示信息**：

| 字段 | 说明 | 类型 |
|-----|------|------|
| **订单号** | 用户申购的订单ID | 只读 |
| **产品名称** | 产品名称 | 只读 |
| **申购金额** | 用户投入的本金 | 只读 |
| **年化收益率** | 产品APY | 只读 |
| **产品期限** | 天数 | 只读 |
| **持有天数** | 从申购确认到赎回的实际天数 | 只读 |
| **累计获得利息** | 迄今为止收到的所有日利息 | 只读 |
| **预期赎回金额** | 本金 + 总利息 | 突出显示 |
| **赎回时刻** | "将在 [日期] 12:00 自动赎回" | 说明文字 |
| **赎回到账户** | 理财账户（可查看余额） | 只读 |

**页面状态**：

| 订单状态 | 显示内容 | 操作按钮 |
|--------|--------|--------|
| **HOLDING（持有中）** | 显示"距离到期还有 X 天"<br>显示每日利息金额<br>显示预期总利息 | ❌ 无赎回按钮（封闭型）<br>可修改自动申购设置 |
| **到期日当天** | 显示"今日到期"<br>显示本期累计利息<br>显示将自动赎回时刻 | 可提前查看赎回结果 |
| **REDEEMED（已赎回）** | 显示赎回时间<br>显示赎回本息合计<br>显示入账金额 | 【查看流水】【重新申购】 |
| **RENEWED（已续期）** | 显示续期时间<br>显示新订单号<br>显示新订单本金 | 【查看新订单】【查看历史】 |

#### 3.2 自动申购设置

**设置位置**：申购确认页（第8项）& 订单详情页

**用户说明文案**：
```
🔄 自动申购（建议开启以获得复利收益）

开启说明：
✓ 到期时，系统会自动将本期的本金+利息作为下一期的本金
✓ 新一期产品遵循相同的年化利率和产品期限
✓ 您可随时在订单详情页修改此设置（修改在下一个到期周期生效）

不开启说明：
✓ 到期时，系统将自动赎回本息到您的账户
✓ 您可在账户中查看本息合计金额
✓ 之后需手动选择产品再次申购

复利示意：
- 第1期：投入 1000，收益 1.34，总计 1001.34
- 第2期：投入 1001.34，收益 1.35，总计 1002.69
- 第3期：投入 1002.69，收益 1.36，总计 1004.05
- 3期复利效益：额外获得 4.05（较单期增加 0.71）
```

### 4. 异常与边界条件

| 场景 | 处理方案 |
|-----|--------|
| **产品已下架，到期时自动申购** | 降级为赎回，本息转入账户，发送通知 |
| **产品额度已满，到期时自动申购** | 降级为赎回，本息转入账户，发送通知 |
| **赎回失败（账户异常）** | 标记订单为 FAILED，发送告警，人工审查 |
| **发息失败（计算错误）** | 重试机制，3次失败后告警 |
| **用户在赎回前退出APP** | 自动赎回流程不受影响，后台执行 |
| **系统账户余额不足** | 立即冻结业务，发送紧急告警 |

---

## 三、版本 A（迭代 V1.1）：封闭型 + 每日发息 + 有手续费

### 1. 手续费设计

**申购手续费**：
```
申购手续费 = 申购本金 × 申购手续费率

例（手续费率 0.5%）：
- 申购 1000 USDT
- 手续费 = 1000 × 0.005 = 5 USDT
- 实际投入本金 = 1000 - 5 = 995 USDT
```

**赎回手续费**：
```
赎回手续费 = 申购本金 × 赎回手续费率

例（赎回手续费率 0.3%）：
- 申购本金 1000 USDT
- 赎回手续费 = 1000 × 0.003 = 3 USDT
```

### 2. 到期赎回公式（版本 A）

**赎回公式**：
```
到期赎回金额 = 申购本金 - 申购手续费 - 赎回手续费 + 总利息
            = 申购本金 × (1 - 申购费率 - 赎回费率) + (申购本金 × APY / 365 × 期限)

例：
- 申购本金 1000 USDT
- 申购费率 0.5%，赎回费率 0.3%
- APY 7%，期限 7 天
- 赎回 = 1000 × (1 - 0.005 - 0.003) + (1000 × 0.07/365 × 7)
       = 1000 × 0.992 + 1.342466
       = 992 + 1.342466
       = 993.342466 USDT
```

**成本分析**：
```
用户净收益 = 赎回金额 - 申购本金
          = -8 USDT + 1.342466 USDT
          = -6.657534 USDT（亏损）

年化收益率（计入手续费）= (净收益 / 申购本金) × (365 / 持有天数)
                    = (-6.657534 / 1000) × (365 / 7)
                    = -0.347%（负收益！）
```

**财务影响**：
- 短期持有：手续费侵蚀利息收益，可能导致亏损
- 推荐：手续费总额不超过 0.5%（申购 + 赎回），才能保证正收益

### 3. 续期本金计算（版本 A）

**续期本金**：
```
续期本金 = 申购本金 - 申购手续费 - 赎回手续费 + 总利息
         = 到期赎回金额

注：续期时，续期本金不再扣手续费（已在第一期扣除）
```

---

## 四、版本 B（迭代 V2.0）：开放型 + 支持提前赎回

### 1. 核心业务逻辑

**产品特性**：
- ✅ **开放型理财**：支持提前赎回（任何时刻可赎回）
- ✅ **提前赎回**：仅返还本金，不付利息（相当于违约金）
- ✅ **到期赎回**：自动赎回本金 + 全期利息
- ✅ **支持自动申购**：到期时可自动续期
- ✅ **无手续费**：全流程无费用（相对 A 版本）

### 2. 关键计算公式

**提前赎回公式**：
```
提前赎回金额 = 申购本金（仅返本，不含利息）

例：
- 申购 1000 USDT
- 持有 3 天后赎回 → 返还 1000 USDT
- 损失：本应获得的 3 天利息 = 1000 × 0.07 / 365 × 3 ≈ 0.575 USDT
```

**到期赎回公式**：
```
到期赎回金额 = 申购本金 + 总利息
            = 申购本金 × (1 + APY / 365 × 产品期限天数)

例（7天产品）：
- 到期赎回 = 1000 × (1 + 0.07/365 × 7) = 1001.342466 USDT
```

### 3. 提前赎回流程

**触发方式**：用户在订单详情页点击"立即赎回"

**赎回步骤**：
```
1. 检查订单状态
   IF status ≠ HOLDING:
     提示"该订单不支持赎回"
     RETURN

2. 收集赎回确认信息
   - 提示"提前赎回将不获得利息"
   - 显示"已获得的日利息：X USDT"
   - 显示"将失去的未来利息：Y USDT"
   - 要求用户确认

3. 执行赎回
   用户账户余额 += 申购本金
   系统账户余额 -= 申购本金
   记录流水（biz_type = EARLY_REDEMPTION）
   订单状态 = REDEEMED

4. 发送通知
   提示"赎回成功，本金已入账"
   显示"失去的利息：Y USDT"（用于用户理解成本）
```

### 4. 提前赎回 vs 到期赎回对比

| 维度 | 提前赎回 | 到期赎回 |
|-----|--------|--------|
| **何时触发** | 用户主动 | 系统自动 |
| **赎回本金** | ✅ 100% 返还 | ✅ 100% 返还 |
| **利息收益** | ❌ 0（损失所有利息） | ✅ 全额（100% 获得） |
| **赎回金额** | 本金仅 | 本金 + 利息 |
| **适用场景** | 急需资金、市场恐慌 | 正常投资周期结束 |
| **收益率** | 负收益 | 正收益（APY） |

**数值示例**（7天产品，1000 USDT，APY 7%）：
```
- 第1天提前赎回 → 1000 USDT（损失 6 天 × 0.1918 = 1.15 USDT）
- 第7天到期赎回 → 1001.34 USDT（获得 7 天全额利息）
- 差额 = 1.34 USDT（用户放弃收益）
```

---

## 五、三版本对比总结

| 特性 | 版本 C（无费） | 版本 A（有费） | 版本 B（开放） |
|-----|-------------|------------|------------|
| **提前赎回** | ❌ 不支持 | ❌ 不支持 | ✅ 支持（只返本） |
| **每日发息** | ✅ 有 | ✅ 有 | ✅ 有 |
| **申购手续费** | ❌ 无 | ✅ 有（0.5%） | ❌ 无 |
| **赎回手续费** | ❌ 无 | ✅ 有（0.3%） | ❌ 无 |
| **到期赎回** | 本金 + 利息 | 本金 - 费用 + 利息 | 本金 + 利息 |
| **自动申购** | ✅ 支持 | ✅ 支持 | ✅ 支持 |
| **用户复杂度** | 🟢 低 | 🟡 中 | 🟠 高 |
| **推荐上线** | V1.0 | V1.1 | V2.0 |

---

## 六、技术实现需求

### 1. 数据库字段扩展

**wealth_order 表**：
```sql
ALTER TABLE wealth_order ADD COLUMN (
  -- 赎回相关
  early_redeemable TINYINT DEFAULT 0,          -- 是否支持提前赎回
  redemption_fee_rate DECIMAL(10,6) DEFAULT 0, -- 赎回手续费率
  redemption_fee_amount DECIMAL(32,16),        -- 实际赎回手续费
  redeemed_at DATETIME,                        -- 赎回时刻
  redemption_amount DECIMAL(32,16),            -- 赎回金额
  redemption_type ENUM('EARLY', 'NORMAL'),     -- 赎回类型

  -- 利息相关
  interest_accrued DECIMAL(32,16) DEFAULT 0,   -- 已累积利息
  interest_total DECIMAL(32,16),                -- 预期总利息
  last_interest_date DATE                       -- 最后发息日期
);
```

### 2. 定时任务

```
每日 12:00：发息任务
- CALL daily_interest_payout()

每日 12:00：赎回任务
- CALL process_redemption_maturity()

每小时：对账任务
- CALL reconcile_redemption_accounts()
```

### 3. 埋点设计

| 事件 | 参数 | 说明 |
|-----|-----|------|
| `redemption_early` | order_id, amount | 提前赎回 |
| `redemption_maturity` | order_id, amount, interest | 到期赎回 |
| `interest_payout` | order_id, amount, daily_count | 日利息派发 |
| `auto_renew_executed` | old_order_id, new_order_id | 自动续期 |

---

## 七、用户文案与教育

### 赎回规则简明版

**版本 C（推荐）**：
```
✅ 无提前赎回：您的资金锁定到期日，确保稳定收益
✅ 每日发息：每天自动获得利息，无需操作
✅ 自动到期：到期日系统自动赎回本息
✅ 0手续费：全流程无任何费用
```

**版本 B**：
```
⚠️ 提前赎回：支持，但仅返本金，失去利息
✅ 每日发息：每天自动获得利息
✅ 到期赎回：获得全额本息收益
✅ 0手续费：全流程无任何费用
```

---

**文档完成日期**：2026-01-08
**下一版本**：V2.0（包含费用模型优化）
