# 静态理财产品文档

## 1. 产品概述

### 产品名称
静态理财（Static Finance）

### 产品定义
静态理财是一款基于区块链的数字资产理财产品，用户可通过购买理财产品获得稳定的收益。产品提供自动申购、智能到期提醒、安全的充提币等功能。

### 核心价值主张
- **稳定收益**：固定利率，透明计算
- **灵活申购**：支持自动申购，降低操作成本
- **资金安全**：与 Safeheron 集成，保障充提币安全
- **智能提醒**：到期前自动发送确认邮件

---

## 2. 用户角色定义

| 角色 | 描述 | 需求 |
|------|------|------|
| **投资者** | 购买理财产品的普通用户 | 获取收益、便捷操作、资金安全 |
| **高端投资者** | 大额投资用户（>1万U） | 更高收益、专业服务支持 |
| **新手投资者** | 首次购买理财产品的用户 | 操作简单、风险低、有指引 |
| **系统管理员** | 产品管理和配置人员 | 产品配置、数据管理、风险控制 |

---

## 3. 用户故事

### 3.1 自动申购功能

#### US-001: 用户设置自动申购计划

**用户角色**：投资者

**故事描述**：
作为投资者，我希望能够设置自动申购计划，这样我可以定期自动申购理财产品，而无需手动操作，从而提高投资效率。

**验收条件**：
- [ ] 用户可在产品详情页设置自动申购选项
- [ ] 支持设置申购周期（周、月、季度、年）
- [ ] 支持自定义申购金额
- [ ] 可随时修改或取消自动申购计划
- [ ] 系统在每个周期自动执行申购操作
- [ ] 用户收到申购成功通知

**业务规则**：
- 自动申购金额需满足产品最小申购额要求
- 用户账户余额必须充足
- 若余额不足，记录失败并重试

---

#### US-002: 自动申购失败处理

**用户角色**：投资者

**故事描述**：
作为投资者，我希望在自动申购失败时能收到通知，了解失败原因，以便及时调整账户余额。

**验收条件**：
- [ ] 申购失败时发送邮件通知
- [ ] 清楚说明失败原因（余额不足/系统异常等）
- [ ] 提供重试选项
- [ ] 记录所有申购历史（成功/失败）

---

### 3.2 利率产品管理

#### US-003: 查看产品利率信息

**用户角色**：投资者

**故事描述**：
作为投资者，我希望能清楚地看到理财产品的利率信息，并理解利率不变的承诺，这样我能做出明智的投资决策。

**验收条件**：
- [ ] 产品详情页展示年化利率/周期利率
- [ ] 清晰标注"利率固定，产品期限内不变"
- [ ] 显示历史利率数据（可选）
- [ ] 支持利率变更预告（需提前通知）

**业务规则**：
- 一旦产品上线，利率在产品周期内不可变更
- 新产品发行时可调整利率
- 利率变更必须提前7天通知已购用户

---

#### US-004: 理解利息计算公式

**用户角色**：投资者

**故事描述**：
作为投资者，我希望了解利息的具体计算方式，知道利息与申购天数的关系，以便验证我的收益。

**验收条件**：
- [ ] 产品页面展示利息计算公式
- [ ] 公式包含"天数系数"说明
- [ ] 提供计算器工具供用户验算
- [ ] 显示预期收益示例

**计算公式**：
```
利息 = 申购金额 × 年化利率 × 实际持有天数 / 365
```

**示例**：
- 申购金额：1,000 USDT
- 年化利率：10%
- 持有天数：30天
- 利息 = 1,000 × 10% × 30 / 365 = 8.22 USDT

---

### 3.3 到期提醒与确认

#### US-005: 接收到期前3天的确认邮件

**用户角色**：投资者

**故事描述**：
作为投资者，我希望在理财产品到期前3天收到确认邮件，以便做好到期准备，并确认本金和利息的到账。

**验收条件**：
- [ ] 系统在到期前3个工作日发送邮件
- [ ] 邮件包含产品名称、到期日期、预期收益金额
- [ ] 邮件包含本金金额和利息金额明细
- [ ] 邮件包含"确认"按钮（可选）
- [ ] 邮件中提醒检查收款地址

**邮件模板内容**：
```
产品名称：[产品名称]
申购金额：[金额] USDT
年化利率：[利率]%
申购日期：[日期]
到期日期：[日期]（距今 3 天）

预期收益明细：
  本金：[金额] USDT
  利息：[金额] USDT
  合计：[总金额] USDT

[确认按钮] [了解详情]
```

---

#### US-006: 到期后查看还本付息详情

**用户角色**：投资者

**故事描述**：
作为投资者，我想在产品到期后能清楚地查看本金和利息的到账详情，确保资金无误。

**验收条件**：
- [ ] 到期日当天或次日本金+利息自动还款
- [ ] 用户能在"资产明细"查看还本付息记录
- [ ] 显示本金、利息、实际收益率、到账时间
- [ ] 支持导出收益明细为 PDF/CSV
- [ ] 邮件通知用户还款完成

---

### 3.4 IP限制与风险管理

#### US-007: 新加坡用户1万U以下申购限制

**用户角色**：新手投资者（来自新加坡）

**故事描述**：
作为来自新加坡的小额投资者，我希望理解为什么小额申购有地理限制，以及如何解除这个限制。

**验收条件**：
- [ ] 检测用户IP地址是否来自新加坡
- [ ] 对新加坡用户的申购额度进行限制：≥1万U可申购，<1万U被拒绝
- [ ] 拒绝时显示清晰的错误提示
- [ ] 提供解除限制的途径说明（KYC升级等）

**限制规则**：
```
IF 用户IP = 新加坡 AND 申购金额 < 10,000 USDT THEN
  拒绝申购
  显示提示："该产品对小额申购有地区限制，请提高申购金额或联系客服"
END
```

**解除限制方式**：
1. 增加申购金额至 ≥1万U
2. 完成高级 KYC 认证
3. 联系客服申请白名单

---

#### US-008: 风险提示与合规通知

**用户角色**：新手投资者

**故事描述**：
作为新手投资者，我希望在申购前能看到清晰的风险提示和合规信息，确保我充分了解产品风险。

**验收条件**：
- [ ] 申购页面显示风险提示信息
- [ ] 提示内容包括市场风险、流动性风险等
- [ ] 要求用户勾选"已阅读风险提示"
- [ ] 显示产品合规信息和监管机构信息

---

### 3.5 充提币与Safeheron集成

#### US-009: 安全充币

**用户角色**：投资者

**故事描述**：
作为投资者，我希望能通过安全的充币流程将资金转入账户，充币过程由 Safeheron 托管，确保资金安全。

**验收条件**：
- [ ] 充币页面显示充币地址（由 Safeheron 生成）
- [ ] 支持多种币种充币（USDT、USDC、BTC等）
- [ ] 实时显示充币状态（待确认/已确认/已入账）
- [ ] 充币确认后自动更新账户余额
- [ ] 提供充币交易哈希查询

**充币流程**：
```
1. 用户点击"充币"按钮
2. 系统调用 Safeheron API 生成充币地址
3. 用户从外部钱包转账至该地址
4. Safeheron 监听区块链，确认到账
5. 系统更新用户余额
6. 用户收到充币成功通知
```

---

#### US-010: 安全提币

**用户角色**：投资者

**故事描述**：
作为投资者，我希望能安全地提取资金到我的钱包，提币由 Safeheron 多签管理，确保资金安全和审批合规。

**验收条件**：
- [ ] 提币页面需要用户输入目标地址
- [ ] 支持地址簿管理（白名单）
- [ ] 显示提币手续费和实际到账金额
- [ ] 需要邮件或二次验证确认
- [ ] Safeheron 多签审批
- [ ] 用户能查看提币状态和历史记录

**提币流程**：
```
1. 用户输入提币地址、金额
2. 系统验证用户身份和地址有效性
3. 发送确认邮件（需点击邮件链接确认）
4. 提交至 Safeheron 多签钱包
5. Safeheron 多签人审批
6. 资金上链，用户收到提币完成通知
```

**提币限制**：
- 单笔提币需通过邮件或身份验证
- 新增地址需要 24 小时冷却期
- 单日提币限额需根据风险等级设定

---

#### US-011: 提币地址管理

**用户角色**：投资者

**故事描述**：
作为安全意识强的投资者，我希望能管理和维护我的提币白名单，避免误向错误地址转账。

**验收条件**：
- [ ] 用户可添加、编辑、删除收款地址
- [ ] 新增地址需要验证（邮件确认或延迟24小时）
- [ ] 显示每个地址的添加时间和最后使用时间
- [ ] 支持地址备注和分类
- [ ] 删除地址时需二次确认

---

#### US-012: 充提币审计日志

**用户角色**：系统管理员

**故事描述**：
作为系统管理员，我希望能查看所有充提币交易的完整审计日志，确保与 Safeheron 的交互记录清晰。

**验收条件**：
- [ ] 记录所有充提币交易详情
- [ ] 包含时间戳、用户ID、金额、状态、交易哈希
- [ ] 支持按日期、用户、状态过滤查询
- [ ] 显示 Safeheron 多签审批信息
- [ ] 支持导出为审计报告

---

## 4. 技术集成说明

### 4.1 Safeheron 集成方案

**集成内容**：
- 充币地址生成与监听
- 提币多签钱包管理
- 交易状态查询
- 审计日志记录

**关键 API 端点**：
```
POST /v1/wallet/generate_deposit_address   # 生成充币地址
POST /v1/wallet/withdraw                   # 提币请求
GET  /v1/wallet/transaction_status/:hash   # 查询交易状态
POST /v1/wallet/approve_withdraw           # 多签审批
```

**安全机制**：
- 所有 API 调用需 HMAC-SHA256 签名
- 启用 IP 白名单
- 定期轮换 API Key

---

### 4.2 邮件系统集成

**邮件触发器**：
1. **到期前3天提醒** - 定时任务每日检查
2. **充币完成通知** - Webhook 回调
3. **提币确认邮件** - 用户手动发起
4. **提币完成通知** - Safeheron 交易确认后
5. **自动申购结果** - 申购操作完成后

**邮件模板**：
- 产品到期提醒
- 充币成功通知
- 提币确认请求
- 提币完成通知
- 自动申购成功/失败

---

## 5. 业务流程

### 5.1 投资者申购流程

```
┌─────────────────────────────────────────────────────┐
│                  查看产品列表                          │
└────────────────────┬────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────┐
│              查看产品详情和利率信息                    │
│         （包含利息计算公式和固定利率说明）            │
└────────────────────┬────────────────────────────────┘
                     │
                     ▼
        ┌────────────────────────────┐
        │    检查IP地址限制            │
        │ (新加坡IP < 1万U被拒)       │
        └────────────┬───────────────┘
                     │
      ┌──────────────┴──────────────┐
      │                             │
   通过(YES)                      不通过(NO)
      │                             │
      ▼                             ▼
  继续申购              显示错误并建议解决方案
      │                             │
      ▼                             ▼
┌─────────────────────┐      提醒升级KYC或增加金额
│ 输入申购金额和周期   │
│ (设置自动申购)      │
└────────┬────────────┘
         │
         ▼
┌─────────────────────┐
│ 阅读风险提示        │
│ 点击同意并确认       │
└────────┬────────────┘
         │
         ▼
┌─────────────────────┐
│ 确认申购信息        │
│ (自动计算预期收益)  │
└────────┬────────────┘
         │
         ▼
     申购成功
         │
         ▼
┌─────────────────────────────────────────┐
│ 发送申购确认邮件                        │
│ 显示预期收益和到期日期                  │
│ 如果启用自动申购，提醒下次申购时间      │
└─────────────────────────────────────────┘
```

---

### 5.2 到期还本付息流程

```
产品持有期
    │
    ▼（到期前3天）
┌─────────────────────────────────┐
│ 系统定时任务检查到期产品        │
│ 发送"到期确认邮件"              │
│ 邮件显示本金、利息、合计金额     │
└────────────┬────────────────────┘
             │
             ▼（到期日期）
┌─────────────────────────────────┐
│ 系统自动执行还本付息             │
│ 本金 + 利息转入用户账户          │
└────────────┬────────────────────┘
             │
             ▼
┌─────────────────────────────────┐
│ 发送还款完成邮件通知             │
│ 用户可查看收益明细               │
│ 用户可导出收益证明               │
└─────────────────────────────────┘
```

---

### 5.3 充提币流程（Safeheron）

#### 充币流程
```
点击充币
    │
    ▼
调用Safeheron API生成充币地址
    │
    ▼
显示充币地址和二维码
    │
    ▼
用户从外部钱包转账
    │
    ▼
Safeheron监听链上确认
    │
    ▼
系统更新用户余额
    │
    ▼
发送充币成功通知邮件
```

#### 提币流程
```
点击提币
    │
    ▼
输入目标地址和金额
    │
    ▼
系统验证（地址合法性、金额限制）
    │
    ▼
发送确认邮件
    │
    ▼（用户点击邮件链接）
二次验证通过
    │
    ▼
提交至Safeheron多签钱包
    │
    ▼
Safeheron多签人审批
    │
    ▼
资金上链
    │
    ▼
发送提币完成通知邮件
```

---

## 6. 数据模型

### 6.1 主要实体

#### 理财产品 (FinanceProduct)
```
{
  id: string                    # 产品ID
  name: string                  # 产品名称
  description: string           # 产品描述
  annualRate: number           # 年化利率（%）
  duration: number             # 产品期限（天）
  minAmount: number            # 最小申购额（USDT）
  maxAmount: number            # 最大申购额（USDT）
  status: enum                 # 上线/下线/已关闭
  rateFixedUntil: datetime     # 利率锁定至
  createdAt: datetime
  updatedAt: datetime
}
```

#### 申购记录 (Subscription)
```
{
  id: string                    # 申购ID
  userId: string               # 用户ID
  productId: string            # 产品ID
  amount: number               # 申购金额
  principal: number            # 本金
  expectedInterest: number     # 预期利息
  actualInterest: number       # 实际利息（到期后填充）
  startDate: datetime          # 申购日期
  endDate: datetime            # 到期日期
  status: enum                 # 进行中/已到期/已赎回
  autoSubscribe: boolean       # 是否启用自动申购
  subscribeCycle: enum         # 申购周期（周/月/季度/年）
  nextSubscribeDate: datetime  # 下次申购日期
}
```

#### 充提币记录 (Transaction)
```
{
  id: string                    # 交易ID
  userId: string               # 用户ID
  type: enum                   # 充币/提币
  currency: string             # 币种
  amount: number               # 金额
  walletAddress: string        # 钱包地址
  txHash: string               # 交易哈希
  status: enum                 # 待确认/已确认/已失败
  safeheronTxId: string        # Safeheron交易ID
  fee: number                  # 手续费
  createdAt: datetime
  confirmedAt: datetime
}
```

#### 用户白名单地址 (WhitelistAddress)
```
{
  id: string                    # 地址ID
  userId: string               # 用户ID
  address: string              # 钱包地址
  label: string                # 地址标签/备注
  verified: boolean            # 是否已验证
  verifiedAt: datetime         # 验证时间
  createdAt: datetime
  lastUsedAt: datetime
}
```

---

## 7. 风险与合规

### 7.1 合规检查

- [ ] KYC/AML 身份验证
- [ ] 地区限制检查（新加坡小额限制）
- [ ] 产品销售许可验证
- [ ] 反洗钱监控
- [ ] 交易异常检测

### 7.2 风险提示

产品页面必须显示以下风险：
1. **市场风险**：利率可能低于预期收益
2. **流动性风险**：产品到期前无法提前赎回
3. **平台风险**：平台破产或运营风险
4. **技术风险**：智能合约漏洞或链上风险
5. **政策风险**：监管政策变化

### 7.3 用户权益保护

- 产品到期必须按时还本付息
- 利率锁定，不得中途变更
- 提供详细的收益明细和审计日志
- Safeheron 多签确保充提币安全

---

## 8. 非功能性需求

| 需求 | 标准 |
|------|------|
| **可用性** | 99.9% 正常运行时间 |
| **响应时间** | 页面加载 < 2秒，API < 500ms |
| **数据安全** | AES-256 加密敏感数据，HTTPS 传输 |
| **审计日志** | 所有交易操作需记录，保留 7 年 |
| **备份恢复** | 每日备份，RTO < 1小时，RPO < 15分钟 |
| **扩展性** | 支持日均 10万+ 用户并发 |

---

## 9. 成功指标 (KPI)

| 指标 | 目标 |
|------|------|
| 产品发行成功率 | ≥ 99% |
| 自动申购成功率 | ≥ 98% |
| 到期还款及时率 | 100% |
| 邮件送达率 | ≥ 99% |
| 用户投诉率 | ≤ 0.1% |
| Safeheron 交易成功率 | ≥ 99.9% |
| 平均到期提醒邮件打开率 | ≥ 60% |

---

## 10. 发布计划

### Phase 1 (MVP) - 2周
- [ ] 基础理财产品管理
- [ ] 手动申购和赎回
- [ ] 利息计算和到期还款
- [ ] 基础邮件通知

### Phase 2 - 2周
- [ ] 自动申购功能
- [ ] IP限制和风险提示
- [ ] 到期前3天邮件提醒
- [ ] 增强邮件模板

### Phase 3 - 3周
- [ ] Safeheron 充币集成
- [ ] Safeheron 提币集成
- [ ] 地址白名单管理
- [ ] 审计日志功能

### Phase 4 - 持续优化
- [ ] 用户反馈优化
- [ ] 性能优化
- [ ] 安全加固
- [ ] 监管合规增强

---

## 11. 相关文件

- API 文档：`/docs/api-specification.md`
- Safeheron 集成指南：`/docs/safeheron-integration.md`
- 邮件模板库：`/docs/email-templates.md`
- 数据库设计：`/docs/database-schema.md`
- 测试计划：`/docs/test-plan.md`

---

**文档版本**：v1.0
**最后更新**：2026-01-06
**维护人**：产品团队
**状态**：进行中
