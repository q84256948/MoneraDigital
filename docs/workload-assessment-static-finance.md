# Monera Digital 静态理财模块开发工作量评估报告

## 1. 评估背景与基准
本报告基于 `static-finance-prd-v3.1.md` 需求文档及当前 MoneraDigital 项目的代码架构进行评估。
- **目标**：实现一个包含申购、计息、自动续购、Safeheron 托管、以及符合合规要求的定期理财系统。
- **开发环境**：Bun/Vite, TypeScript, React, Drizzle ORM, Vercel Serverless Functions。
- **核心挑战**：金融级计算精度控制、Safeheron 异步回调状态机、T+1 撮合引擎。

---

## 2. 模块化工作量拆解

### 2.1 数据库架构与数据模型 (Database & Models)
- **工期评估**：3 人天 (PD)
- **主要内容**：
    - 设计 `finance_products` (产品)、`finance_orders` (订单)、`interest_logs` (计息流水) 等核心表。
    - 建立与现有 `users` 表的关联逻辑。
    - 编写 Drizzle Migrations 及基础 DAO 层代码。

### 2.2 管理后台功能 (Admin Management)
- **工期评估**：4 人天 (PD)
- **主要内容**：
    - 产品发布、上架/下架、动态利率调整 API。
    - 订单监控面板后端逻辑（支持状态筛选、手动对账）。
    - 业务汇总统计（全站总资产、待支付利息等）。

### 2.3 Safeheron 资金存管集成 (Safeheron Integration)
- **工期评估**：6 人天 (PD)
- **主要内容**：
    - 封装 Safeheron SDK 与签名验证机制。
    - 充值流：地址分配、Webhook 幂等处理、资产入账逻辑。
    - 提币流：提币申请发起、多签状态流转监听、轮询补偿逻辑。

### 2.4 撮合引擎与自动化结算 (Finance Engine)
- **工期评估**：7 人天 (PD)
- **主要内容**：
    - **T+1 撮合系统**：处理每日 12:00 的订单确认逻辑，解决高并发下的额度锁定。
    - **每日计息脚本**：执行 18 位精度计算，处理复利发放。
    - **自动续购逻辑**：实现到期后的本息复投流程（自动触发新订单）。
    - **合规插件**：新加坡 IP 地址库集成及金额前置过滤中间件。

### 2.5 前端用户体验与交互 (Frontend UI/UX)
- **工期评估**：8 人天 (PD)
- **主要内容**：
    - 产品广场（支持 APR 排序、售罄进度展示）。
    - 申购交互流（含 2FA 集成、IP/金额动态提醒）。
    - 资产详情页：收益日历、收益曲线图、自动续购 Toggle 控制。
    - 移动端响应式优化。

### 2.6 邮件通知与 DevOps (Notifications & Deployment)
- **工期评估**：2 人天 (PD)
- **主要内容**：
    - 整合 Resend 邮件服务。
    - 开发 T-3 到期确认通知模板与调度器。
    - Vercel Cron Jobs 配置与异常监控告警设置。

---

## 3. 工期汇总与排期建议

| 阶段 | 核心目标 | 持续时间 (PD) | 风险 |
| :--- | :--- | :---: | :--- |
| 第一周 | 数据库架构 + 后端基础服务 | 7 | 低 |
| 第二周 | Safeheron 对接 + 充提币闭环 | 8 | 高 |
| 第三周 | 计息引擎 + 自动撮合逻辑 | 7 | 中 |
| 第四周 | 前端 UI 实现 + 交互优化 | 6 | 中 |
| 第五周 | 联调测试 + Bug 修复 + 部署 | 4 | 低 |

- **纯开发合计**：32 人天
- **项目缓冲 (Contingency, 15%)**：5 人天
- **总计估算**：**37 人天**

---

## 4. 关键风险与应对策略
1. **精度风险**：JS 对超大数值处理存在精度损失。
   - *应对*：强制要求使用 `Decimal.js`，且数据库字段统一为 `numeric(36,18)`。
2. **Safeheron Webhook 丢失**：网络抖动可能导致充币不入账。
   - *应对*：实现“Webhook + 定时轮询”的双重确认机制。
3. **撮合并发冲突**：多用户同时申购导致产品超卖。
   - *应对*：在 Vercel Functions 中利用 PostgreSQL 事务行锁进行额度扣减。

---

**评估人**：MoneraDigital 架构组  
**日期**：2026-01-06
